Option Explicit
Sub RandomSample()

MakeArray

End Sub

Sub MakeArray()
Application.EnableEvents = False
    Dim MyArray As Variant
    Dim i As Integer
    Dim TryRand As Integer
    Dim RowCount As Integer
    Dim rngCurrentRegion As range
    Dim NewWs As Worksheet
    Dim CurrentWSName As String
    CurrentWSName = Application.ActiveSheet.name
    

    'Get User Input
    Dim form As New SelectionParams
    Dim rng As range
  '  Set rng = range("a1")
    Dim Quantity As Integer
    
RequestInput:
    form.Show vbModal
    Set rng = range(form.range.text)
    Quantity = form.SampleSize
    
    ' process user input
    RowCount = rng.rows.count
    If Quantity >= RowCount Then
        MsgBox ("Choose selection size that's smaller than row count")
        GoTo RequestInput
    End If

    ReDim MyArray(Quantity - 1)
    
    For i = 0 To Quantity - 1
retry:
        ' get random int values loaded into array
        TryRand = RndBetween(1, RowCount)
        If IsInArray(TryRand, MyArray) Then GoTo retry
        MyArray(i) = TryRand
    Next
    
    MsgBox ("the row count is " & RowCount & " and the sample size is " & Quantity)
    
    '' we got the user input, and we made the array of random numbers
    '' they are not ordered. For our purposes, that doesn't matter, even for optimization I think.
    '' can they be ordered? I'm sure with more code. Which brings us to the TODOs.
    
    '' TODO
    '' Copy worksheet or at least used area or used array
    Set rngCurrentRegion = rng.CurrentRegion
    Set NewWs = Application.ActiveWorkbook.Worksheets.add(after:=Application.ActiveWorkbook.ActiveSheet)
    
    If Not WorksheetExists("sample") Then
        NewWs.name = "Sample"
    End If
    
    ' Try to copy range over
    Worksheets(CurrentWSName).rng.CurrentRegion.Copy NewWs
    
    'NewWs.range("a5").Formula = rngCurrentRegion
    

End Sub


Function RndBetween(Low, High) As Integer
   Randomize
   RndBetween = Int((High - Low + 1) * Rnd + Low)
End Function

Private Function IsInArray(valToBeFound As Variant, arr As Variant) As Boolean
'DEVELOPER: Ryan Wells (wellsr.com)
'DESCRIPTION: Function to check if a value is in an array of values
'INPUT: Pass the function a value to search for and an array of values of any data type.
'OUTPUT: True if is in array, false otherwise
Dim element As Variant
On Error GoTo IsInArrayError: 'array is empty
    For Each element In arr
        If element = valToBeFound Then
            IsInArray = True
            Exit Function
        End If
    Next element
Exit Function
IsInArrayError:
On Error GoTo 0
IsInArray = False
End Function

Function WorksheetExists(sName As String) As Boolean
On Error Resume Next ''shouldn't need but just in case
    WorksheetExists = Evaluate("ISREF('" & sName & "'!A1)")
End Function
